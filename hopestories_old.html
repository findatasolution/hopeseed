<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Hope Stories</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;600;700&family=Sora:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxuvwv/b4jzlGC62Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            color-scheme: light;
            --accent: #34b3d3;
            --accent-strong: #0284c7;
            --accent-dark: #1e3a8a;
            --accent-soft: rgba(2, 132, 199, 0.12);
            --card-bg: #f0f9ff;
            --card-border: rgba(2, 132, 199, 0.2);
        }

        html, body {
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            background: linear-gradient(125deg, #e0f2fe 0%, #bae6fd 45%, #ffffff 100%);
            color: #083344;
        }

        .glass-card {
            background: rgba(240, 249, 255, 0.94);
            backdrop-filter: blur(22px);
            border: 1px solid var(--card-border);
            box-shadow: 0 28px 55px -28px rgba(2, 132, 199, 0.35);
        }

        .dashboard-backdrop {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
        }

        .dashboard-backdrop div {
            position: absolute;
            border-radius: 9999px;
            filter: blur(120px);
            opacity: 0.65;
        }

        .dashboard-backdrop div:nth-child(1) {
            width: 540px;
            height: 540px;
            background: rgba(2, 132, 199, 0.32);
            top: -120px;
            left: -140px;
        }

        .dashboard-backdrop div:nth-child(2) {
            width: 480px;
            height: 480px;
            background: rgba(125, 211, 252, 0.28);
            bottom: -160px;
            right: -120px;
        }

        .dashboard-backdrop div:nth-child(3) {
            width: 380px;
            height: 380px;
            background: rgba(147, 197, 253, 0.24);
            top: 38%;
            right: 28%;
        }

        .bg-blue-500 {
            background-color: var(--accent) !important;
        }

        .hover\:bg-blue-600:hover {
            background-color: var(--accent-dark) !important;
        }

        .bg-blue-50 {
            background-color: var(--accent-soft) !important;
        }

        .text-blue-600 {
            color: var(--accent-strong) !important;
        }

        .text-blue-700 {
            color: var(--accent-dark) !important;
        }

        .border-blue-200 {
            border-color: rgba(2, 132, 199, 0.42) !important;
        }

        .border-blue-200\/60 {
            border-color: rgba(2, 132, 199, 0.28) !important;
        }

        .border-blue-100\/60 {
            border-color: rgba(2, 132, 199, 0.18) !important;
        }

        .ring-blue-200 {
            --tw-ring-color: rgba(2, 132, 199, 0.28) !important;
        }

        .ring-blue-100 {
            --tw-ring-color: rgba(2, 132, 199, 0.18) !important;
        }

        .shadow-blue-500\/40 {
            box-shadow: 0 18px 48px rgba(2, 132, 199, 0.32) !important;
        }

        .shadow-blue-500\/30 {
            box-shadow: 0 18px 42px rgba(2, 132, 199, 0.24) !important;
        }

        .shadow-blue-500\/20 {
            box-shadow: 0 12px 28px rgba(2, 132, 199, 0.18) !important;
        }

        .hover\:bg-blue-50:hover {
            background-color: rgba(2, 132, 199, 0.12) !important;
        }
    </style>
</head>
<body class="relative text-slate-700">
    <div class="dashboard-backdrop" aria-hidden="true">
    </div>
    <div class="relative z-10">
    <nav class="max-w-6xl mx-auto px-6 pt-8">
      <div class="glass-card rounded-3xl px-6 py-5 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <a href="index.html" class="flex items-center gap-3">
          <span class="inline-flex h-12 w-12 items-center justify-center rounded-2xl">
                <img src="https://ik.imagekit.io/o2u9hny2s/hopeseed/LOGO8.png"
                 alt="logo" class="h-full w-full object-contain bg-transparent" loading="lazy"/>
          </span>
          <div>
            <p class="text-xs uppercase tracking-[0.35em] text-black-700" data-i18n="brand_tag">HopeSeed</p>
            <p class="text-base font-semibold text-slate-900" data-i18n="brand_title">Hệ thống quyên góp P2P </p>
          </div>
        </a>
        <div class="flex flex-wrap items-center gap-3 text-sm">
          <a href="campaigns.html" class="inline-flex items-center gap-2 rounded-full bg-white/80 px-4 py-1 text-sm font-medium text-blue-600 shadow-sm ring-1 ring-blue-200"><i class="fas fa-concierge-bell mr-1"></i>+ Create a campaign</a>
          <button id="langBtn" class="rounded-full border border-blue-200/60 bg-white/70 px-3 py-1 text-blue-700 hover:bg-blue-50 transition" title="Switch language">EN / VI</button>
          <!-- <span id="userInfo" class="rounded-full bg-blue-50 px-3 py-1 text-blue-700 border border-blue-200/60" data-i18n="not_logged">Chưa đăng nhập</span> -->
          <button id="logoutBtn" class="hidden rounded-full border border-red-200 px-3 py-1 text-red-600 transition hover:bg-red-50">
            <i class="fas fa-sign-out-alt mr-1"></i><span data-i18n="logout">Đăng xuất</span>
          </button>
          <button id="loginToggleBtn" class="rounded-full bg-slate-900 px-4 py-2 text-white transition hover:bg-slate-800 shadow-lg shadow-slate-900/20">
            <i class="fas fa-sign-in-alt mr-1"></i><span data-i18n="login">Đăng nhập/Đăng ký</span>
          </button>
        </div>
      </div>
    </nav>
        <main class="max-w-6xl mx-auto px-6 mt-16 pb-20">
            <div class="glass-card rounded-3xl p-6 md:p-8 space-y-8">
                <div class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between">
                    <div>
                        <h2 class="text-4xl sm:text-2xl font-normal leading-snug text-slate-700 font-[Pacifico]">Những mảnh đời yêu thương</h2>
                        <p class="text-sm text-slate-500">Rất xin lỗi, hiện tại chưa có trường hợp nào. Vui lòng tạo tài khỏan để nhận thông tin khi có update nhé</p>
                    </div>
                    <p class="text-xs uppercase tracking-[0.4em] text-blue-600">...</p>
                </div>
                <div id="productsList" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3"></div>
            </div>
        </main>
    </div>
    
    <!-- OVERLAY -->
    <div id="overlay" class="overlay"></div>

    <!-- AUTH PANEL -->
    <div id="loginPanel" class="fixed top-0 right-0 h-full w-full max-w-sm bg-white/95 shadow-2xl slide-out z-50 p-6">
      <button type="button" onclick="closeAuth()" class="absolute right-5 top-5 text-slate-400 hover:text-slate-600">
        <i class="fas fa-times"></i>
      </button>

      <!-- <h3 class="text-xl font-semibold text-slate-900 mb-4">Tài khoản</h3> -->

      <!-- Tabs -->
      <div class="tabs mb-5">
        <button type="button" id="tabLogin" class="tab-btn active" onclick="switchAuthTab('login')">Đăng nhập</button>
        <button id="tabSignup" class="tab-btn" onclick="switchAuthTab('signup')">Đăng ký</button>
      </div>

      <!-- LOGIN -->
      <form id="loginForm" class="space-y-4">
        <div class="flex flex-col gap-2">
          <label for="email" class="text-xs font-medium uppercase tracking-wide text-slate-500" data-i18n="email">Email</label>
          <input type="email" id="email" class="w-full rounded-2xl border border-slate-200 bg-white/90 px-4 py-2 text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-100" required/>
        </div>
        <div class="flex flex-col gap-2 relative">
          <label for="password" class="text-xs font-medium uppercase tracking-wide text-slate-500" data-i18n="password">Mật khẩu</label>
          <input type="password" id="password" class="w-full rounded-2xl border border-slate-200 bg-white/90 px-4 py-2 pr-10 text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-100" required/>
          <button class="eye-btn" type="button" onclick="toggleEye('password')"><i class="fa-regular fa-eye"></i></button>
        </div>
        <label class="inline-flex items-center gap-2 text-xs text-slate-600">
          <input id="rememberMe" type="checkbox" class="rounded border-slate-300"> Ghi nhớ đăng nhập
        </label>
        <div class="pt-1">
          <button id="loginBtn" type="submit" class="w-full rounded-full bg-blue-500 px-4 py-3 font-medium text-white shadow-lg shadow-blue-500/30 transition hover:-translate-y-0.5 hover:bg-blue-600">
            Đăng nhập
          </button>
        </div>
      </form>

      <!-- SIGNUP -->
      <form id="signupForm" class="space-y-4 hidden">
        <div class="flex flex-col gap-2">
          <label class="text-xs font-medium uppercase tracking-wide text-slate-500">Email</label>
          <input type="email" id="su_email" class="w-full rounded-2xl border border-slate-200 bg-white/90 px-4 py-2 text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-100" required/>
        </div>
        <div class="flex flex-col gap-2 relative">
          <label class="text-xs font-medium uppercase tracking-wide text-slate-500">Mật khẩu</label>
          <input type="password" id="su_password" class="w-full rounded-2xl border border-slate-200 bg-white/90 px-4 py-2 pr-10 text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-100" minlength="6" required/>
          <button class="eye-btn" type="button" onclick="toggleEye('su_password')"><i class="fa-regular fa-eye"></i></button>
        </div>
        <!-- Field phone (tuỳ chọn) để khớp UserRegister -->
        <div class="flex flex-col gap-2">
          <label class="text-xs font-medium uppercase tracking-wide text-slate-500">Số điện thoại (tuỳ chọn)</label>
          <input type="tel" id="su_phone" class="w-full rounded-2xl border border-slate-200 bg-white/90 px-4 py-2 text-sm focus:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-100" inputmode="numeric" />
        </div>
        <div class="pt-1">
          <button id="signupBtn" type="submit" class="w-full rounded-full bg-blue-500 px-4 py-3 font-medium text-white shadow-lg shadow-blue-500/30 transition hover:-translate-y-0.5 hover:bg-blue-600">
            Tạo tài khoản
          </button>
        </div>
        <p class="text-xs text-slate-500">Bằng việc đăng ký, bạn đồng ý với điều khoản & chính sách bảo mật.</p>
      </form>
    </div>

    <!-- FAB auth -->
    <div class="fab-wrap" id="fab">
      <div class="fab-tray">
        <button class="fab-btn" onclick="openAuth('login')"><i class="fas fa-right-to-bracket mr-1"></i> Đăng nhập</button>
        <button class="fab-btn" onclick="openAuth('signup')"><i class="fas fa-user-plus mr-1"></i> Đăng ký</button>
      </div>
      <button class="fab-main" id="fabMain" title="Tài khoản">
        <i class="fas fa-user"></i>
      </button>
    </div>
  </div>
    <script>
        const API_BASE = (function(){
        const env = window.HOPESEED_API_BASE; // optional build/runtime inject
        if (env) return env.replace(/\/$/, '');
        const host = location.hostname;
        if (host === 'localhost' || host === '127.0.0.1') return 'http://localhost:8000';
        return '/api';
        })();
        const translations = {
            en: {
                loading: 'Loading...',
                noProducts: 'Thật d.',
                serverError: 'Cannot connect to server.',
                errorAlert: 'An error occurred',
            }
        };

        function getToken() {
            return localStorage.getItem("access_token") || '';
        }

        function getEmail() {
            return localStorage.getItem("user_email") || '';
        }

        function logout() {
            localStorage.clear();
            location.href = 'index.html';
        }

        async function loadProducts() {
            const wrap = document.getElementById("productsList");
            if (!wrap) return;
            const t = translations.en;
            wrap.innerHTML = `<p class='rounded-3xl border border-dashed border-blue-200 bg-white/60 px-4 py-6 text-center text-sm text-blue-600'>${t.loading}</p>`;
            try {
                const res = await fetch(`${API_BASE}/products`, {
                    headers: { "Authorization": `Bearer ${getToken()}` }
                });
                const products = await res.json();
                if (!res.ok) {
                    wrap.innerHTML = `<p class='rounded-2xl border border-red-200 bg-white/70 px-4 py-5 text-center text-sm text-red-600'>${products.detail || t.errorAlert}</p>`;
                    return;
                }
                if (!Array.isArray(products) || !products.length) {
                    wrap.innerHTML = `<p class='rounded-2xl border border-slate-200 bg-white/70 px-4 py-6 text-center text-sm text-slate-400'>${t.noProducts}</p>`;
                    return;
                }

                const productIds = products.map(p => p.product_id);
                const imagesRes = await fetch(`${API_BASE}/images?product_ids=${productIds.join(',')}`, {
                    headers: { "Authorization": `Bearer ${getToken()}` }
                });
                const images = await imagesRes.json();
                const imageMap = {};
                if (imagesRes.ok) {
                    images.forEach(img => {
                        if (!imageMap[img.product_id]) imageMap[img.product_id] = [];
                        imageMap[img.product_id].push(img);
                    });
                }

                wrap.innerHTML = products.map(p => {
                    const imgSrc = imageMap[p.product_id]?.[0]?.url || 'https://images.unsplash.com/photo-1505691723518-36a5ac3be353?auto=format&fit=crop&w=900&q=70';
                    const priceValue = Number.isFinite(Number(p.price)) ? Number(p.price) : null;
                    const priceLabel = priceValue !== null ? priceValue.toLocaleString('en-US') + ' VND' : '-';
                    const quantityLabel = p.quantity_type ? ' ' + p.quantity_type : '';
                    const start = p.price_start_date ?? '-';
                    const description = p.description ?? '';
                    const title = p.main_type + (p.sub_type ? ' - ' + p.sub_type : '');
                    return `
                    <article class="group relative overflow-hidden rounded-3xl border border-blue-100/60 bg-white/85 shadow-lg shadow-blue-500/10 flex flex-col">
                        <div class="relative h-48 overflow-hidden">
                            <img src="${imgSrc}" alt="${title}" class="h-full w-full object-cover transition duration-500 group-hover:scale-105" loading="lazy"/>
                            <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/65 to-transparent px-5 pb-4 pt-12 text-white">
                                <h4 class="text-lg font-semibold">${title}</h4>
                            </div>
                        </div>
                        <div class="flex flex-1 flex-col gap-2 px-5 py-4 text-sm text-slate-600">
                            <p class="text-base font-semibold text-blue-600">${priceLabel}${quantityLabel}</p>
                            <p class="text-xs uppercase tracking-wide text-slate-400">Effective from: ${start}</p>
                            <p class="text-sm text-slate-600">${description}</p>
                        </div>
                    </article>`;
                }).join("");
            } catch (error) {
                console.error('Error loading products:', error);
                wrap.innerHTML = `<p class='rounded-2xl border border-red-200 bg-white/70 px-4 py-5 text-center text-sm text-red-600'>${t.serverError}</p>`;
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const userInfo = document.getElementById("userInfo");
            if (userInfo) {
                userInfo.textContent = getEmail();
            }
            loadProducts();
        });
    </script>
</body>
</html>